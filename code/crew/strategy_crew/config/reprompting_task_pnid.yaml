reprompt_strategy:
  task: Analyze failed or ineffective actions from the plant_operator and suggest a modified plan.
  description: >
    When the validation agent detects that an action was not successfully executed (e.g., flow obstruction, incorrect valve status, or insufficient pump power), this agent receives the fault context and current system state.

    The goal is to analyze what went wrong, and design a step-by-step correction plan.

    **Plant Function:**
      - Mixing of three liquids, sequentially transferred from tanks B201, B202, and B203 into tank B204.

    **Plant Structure:**
      - The system P&ID diagram is as follows (structured as a node-edge format or textual description):
        {plant_structure}

      **State Graph:**
      - The State Graph represents the sequence of operations in the plant. It is a directed graph where each node represents a state and each edge represents a transition condition between states.
      - The transitions happen only when the conditions are met. 
      - The state graph is as follows:
        fill_tank_B201 --> fill_tank_B202 --> fill_tank_B203 --> drain_tank_B201 --> drain_tank_B202 --> drain_tank_B203 --> end
        Below are the transitions and conditions:
        - fill_tank_B201 → fill_tank_B202  if B201 > 0.032m
        - fill_tank_B202 → fill_tank_B203  if B202 > 0.032m
        - fill_tank_B203 → drain_tank_B201 if B203 > 0.032m
        - drain_tank_B201 → drain_tank_B202 if B201 < 0.022m
        - drain_tank_B202 → drain_tank_B203 if B202 < 0.022m
        - drain_tank_B203 → end if B203 < 0.022m

      - Analyse the state graph and identify the current state of the system.
      - Based on the current state, identify the next state and the conditions required to transition to that state.
      - Take appropriate action to transition to the next state only when the conditions are met.

    **Current State:**
      - The level of tank B201 is {B201_level}m 
      - The level of tank B202 is {B202_level}m 
      - The level of tank B203 is {B203_level}m 
      - The level of tank B204 is {B204_level}m 
      - The valve_in0 is {valve_in0} 
      - The valve_in1 is {valve_in1}
      - The valve_in2 is {valve_in2}
      - The valve_pump_tank_B201 is {valve_pump_tank_B201} 
      - The valve_pump_tank_B202 is {valve_pump_tank_B202} 
      - The valve_pump_tank_B203 is {valve_pump_tank_B203} 
      - The valve_pump_tank_B204 is {valve_pump_tank_B204} 
      - The valve_out is {valve_out}
      - The pump power is {pump_power} times of max pump power of 750W.
    
    **System Specifications:**
      - Valves B201, B202, B203 and B204 are solenoid valves that is on or off only. 
      - The pump power can be adjusted between 0 and 1 (0 to 750W).
      
    - Validation agent has flagged an issue with the current operation. 
      - The issue flagged is {issue_flagged}.
      - Look at the issue and analyze the current state of the system.
      - Identify the valves/pump power casuing this issue and suggest corrective action.
      - Check all the actuators for their current state and suggest corrective action.
      - If more valves are open then required, suggest closing the extra valves and only keeping the required valves open.
      - Do not change the pump power if not required.
    **Actuators:**
    - The agent can manipulate the following actuators:
      - **Valves:** valve_in0, valve_in1, valve_in2, valve_pump_tank_B201, valve_pump_tank_B202, valve_pump_tank_B203, valve_pump_tank_B204, valve_out
      - **Pump Power:** Adjust the pump power between 0 and 1 (0 to 750W).

    **What to do:**
    - Analyze the current state and detected faults and manipulate the acutators to overcome the issues.

    **Output Format:**
    - List of new valve/pump commands.
    - Reasoning for each change.
    - Confirmation that this plan should be retried by the plant operator agent.

  agent: reprompt_agent
  expected_output: >
    Suggested corrective actions with detailed reasoning. This should be relayed back to the plant_operator agent to retry the operation effectively.
